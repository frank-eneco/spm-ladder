<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ladder Tournament</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase v9 compat for easier migration -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-compat-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-compat-database.js"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-2xl mx-auto bg-white rounded-xl shadow-2xl overflow-hidden">
            <!-- Header -->
            <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6">
                <h1 class="text-3xl font-bold text-center">🏆 Ladder Tournament</h1>
                <p class="text-center mt-2 opacity-90">Manage your tournament rankings</p>
            </div>

            <!-- Add Player Section -->
            <div class="p-6 bg-gray-50 border-b">
                <div class="flex gap-3">
                    <input 
                        type="text" 
                        id="playerName" 
                        placeholder="Enter player name..." 
                        class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
                        maxlength="30"
                    >
                    <button 
                        id="addPlayerBtn" 
                        class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-all duration-200 transform hover:scale-105"
                    >
                        Add Player
                    </button>
                </div>
                <div class="mt-2 text-sm text-gray-600">
                    <span id="playerCount">0</span> players • Press Enter to add quickly
                </div>
            </div>

            <!-- Ladder Section -->
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-gray-800">Current Ladder</h2>
                    <button 
                        id="resetBtn" 
                        class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors"
                    >
                        Reset All
                    </button>
                </div>

                <!-- Ladder List -->
                <div id="ladderContainer" class="space-y-2">
                    <!-- Players will be rendered here -->
                </div>

                <!-- Empty State -->
                <div id="emptyState" class="text-center py-12 text-gray-500">
                    <div class="text-6xl mb-4">🎯</div>
                    <h3 class="text-lg font-medium mb-2">No Players Yet</h3>
                    <p class="text-sm">Add your first player to start the tournament!</p>
                </div>

                <!-- Loading State -->
                <div id="loadingState" class="text-center py-12 text-gray-500">
                    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mb-4"></div>
                    <p>Connecting to database...</p>
                </div>
            </div>

            <!-- Footer -->
            <div class="bg-gray-50 px-6 py-4 text-center text-sm text-gray-600 border-t">
                <p>📱 Real-time sync across all devices • 🔄 Changes saved automatically</p>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCTfDaYZ5e7frfkVQpnJS460a5_xOI2cwA",
            authDomain: "spm-ladder.firebaseapp.com",
            databaseURL: "https://spm-ladder-default-rtdb.firebaseio.com/",
            projectId: "spm-ladder",
            storageBucket: "spm-ladder.firebasestorage.app",
            messagingSenderId: "164520026060",
            appId: "1:164520026060:web:a68ce945f128bec4b38769"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const ladderRef = database.ref('ladder');

        // DOM Elements
        const playerNameInput = document.getElementById('playerName');
        const addPlayerBtn = document.getElementById('addPlayerBtn');
        const resetBtn = document.getElementById('resetBtn');
        const ladderContainer = document.getElementById('ladderContainer');
        const emptyState = document.getElementById('emptyState');
        const loadingState = document.getElementById('loadingState');
        const playerCount = document.getElementById('playerCount');

        // State
        let currentLadder = [];
        let isLoading = true;

        // Show loading initially
        showLoading();

        // Render ladder
        function renderLadder(players) {
            ladderContainer.innerHTML = '';
            
            if (!players || players.length === 0) {
                showEmptyState();
                return;
            }

            hideEmptyState();
            hideLoading();

            players.forEach((player, index) => {
                const playerElement = document.createElement('div');
                playerElement.className = 'flex items-center justify-between bg-white border border-gray-200 rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow';
                
                playerElement.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="flex-shrink-0 w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-full flex items-center justify-center font-bold text-sm">
                            ${index + 1}
                        </div>
                        <span class="font-medium text-gray-800">${escapeHtml(player)}</span>
                        ${index === 0 ? '<span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-xs font-medium">👑 Leader</span>' : ''}
                    </div>
                    <div class="flex items-center space-x-2">
                        ${index > 0 ? `<button onclick="movePlayerUp(${index})" class="p-2 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-full transition-colors" title="Move up">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                            </svg>
                        </button>` : ''}
                        ${index < players.length - 1 ? `<button onclick="movePlayerDown(${index})" class="p-2 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-full transition-colors" title="Move down">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>` : ''}
                        <button onclick="removePlayer(${index})" class="p-2 text-red-600 hover:text-red-800 hover:bg-red-50 rounded-full transition-colors" title="Remove player">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                        </button>
                    </div>
                `;
                
                ladderContainer.appendChild(playerElement);
            });

            updatePlayerCount(players.length);
        }

        // Utility functions
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showEmptyState() {
            emptyState.style.display = 'block';
            updatePlayerCount(0);
        }

        function hideEmptyState() {
            emptyState.style.display = 'none';
        }

        function showLoading() {
            loadingState.style.display = 'block';
            emptyState.style.display = 'none';
        }

        function hideLoading() {
            loadingState.style.display = 'none';
        }

        function updatePlayerCount(count) {
            playerCount.textContent = count;
        }

        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg text-white font-medium shadow-lg z-50 transform translate-x-full transition-transform duration-300 ${
                type === 'error' ? 'bg-red-500' : type === 'success' ? 'bg-green-500' : 'bg-blue-500'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Slide in
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            // Slide out and remove
            setTimeout(() => {
                notification.style.transform = 'translateX(full)';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Player management functions
        function addPlayer() {
            const name = playerNameInput.value.trim();
            
            if (!name) {
                showNotification('Please enter a player name', 'error');
                return;
            }

            if (name.length > 30) {
                showNotification('Player name is too long', 'error');
                return;
            }

            if (currentLadder.includes(name)) {
                showNotification('Player already exists in the ladder', 'error');
                return;
            }

            currentLadder.push(name);
            playerNameInput.value = '';
            updateFirebase();
            showNotification(`${name} added to the ladder!`, 'success');
        }

        function removePlayer(index) {
            if (index < 0 || index >= currentLadder.length) return;
            
            const playerName = currentLadder[index];
            if (confirm(`Remove "${playerName}" from the ladder?`)) {
                currentLadder.splice(index, 1);
                updateFirebase();
                showNotification(`${playerName} removed from the ladder`, 'info');
            }
        }

        function movePlayerUp(index) {
            if (index <= 0 || index >= currentLadder.length) return;
            
            const temp = currentLadder[index];
            currentLadder[index] = currentLadder[index - 1];
            currentLadder[index - 1] = temp;
            updateFirebase();
            showNotification(`${temp} moved up!`, 'success');
        }

        function movePlayerDown(index) {
            if (index < 0 || index >= currentLadder.length - 1) return;
            
            const temp = currentLadder[index];
            currentLadder[index] = currentLadder[index + 1];
            currentLadder[index + 1] = temp;
            updateFirebase();
            showNotification(`${temp} moved down!`, 'info');
        }

        function resetLadder() {
            if (currentLadder.length === 0) {
                showNotification('Ladder is already empty', 'info');
                return;
            }
            
            if (confirm('Are you sure you want to reset the entire ladder? This cannot be undone.')) {
                currentLadder = [];
                updateFirebase();
                showNotification('Ladder reset successfully', 'success');
            }
        }

        // Firebase functions
        function updateFirebase() {
            ladderRef.set(currentLadder).catch(error => {
                console.error('Firebase error:', error);
                showNotification('Failed to save changes. Please try again.', 'error');
            });
        }

        // Firebase listener
        ladderRef.on('value', (snapshot) => {
            isLoading = false;
            const data = snapshot.val();
            currentLadder = data ? (Array.isArray(data) ? data : Object.values(data)) : [];
            renderLadder(currentLadder);
        }, (error) => {
            isLoading = false;
            console.error('Firebase read error:', error);
            hideLoading();
            showNotification('Failed to connect to database', 'error');
        });

        // Event listeners
        addPlayerBtn.addEventListener('click', addPlayer);
        resetBtn.addEventListener('click', resetLadder);

        playerNameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addPlayer();
            }
        });

        // Focus on input when page loads
        window.addEventListener('load', () => {
            playerNameInput.focus();
        });

        // Make functions globally accessible for onclick handlers
        window.movePlayerUp = movePlayerUp;
        window.movePlayerDown = movePlayerDown;
        window.removePlayer = removePlayer;
    </script>
</body>
</html>
